"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const path_1 = require("path");
const util_1 = require("util");
/**
 * Removes comments and whitespace from a PHP script, by calling a PHP process.
 */
class SafeTransformer {
    /**
     * Creates a new safe transformer.
     * @param _executable The path to the PHP executable.
     */
    constructor(_executable = 'php') {
        this._executable = _executable;
    }
    /**
     * The class name.
     */
    get [Symbol.toStringTag]() {
        return 'SafeTransformer';
    }
    /**
     * Closes this transformer and releases any resources associated with it.
     * @return Completes when the transformer is finally disposed.
     */
    async close() {
        return undefined;
    }
    /**
     * Processes a PHP script.
     * @param script The path to the PHP script.
     * @return The transformed script.
     */
    async transform(script) {
        const exec = util_1.promisify(child_process_1.execFile);
        const { stdout } = await exec(this._executable, ['-w', path_1.resolve(script)], { maxBuffer: 10 * 1024 * 1024 });
        return stdout;
    }
}
exports.SafeTransformer = SafeTransformer;
//# sourceMappingURL=safe_transformer.js.map